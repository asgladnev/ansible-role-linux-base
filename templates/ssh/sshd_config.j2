# ============================================================ #
# Auto-generated by Ansible                                    #
# Do not edit manually! Changes will be overwritten.           #
# ============================================================ #

{# Include additional configuration files from sshd_config.d directory #}
Include /etc/ssh/sshd_config.d/*.conf

{# Basic SSH settings #}
{% if sshd_config.port is defined %}
Port {{ sshd_config.port }}  {# SSH listening port #}
{% endif %}

HostKey /etc/ssh/ssh_host_rsa_key
HostKey /etc/ssh/ssh_host_ecdsa_key
HostKey /etc/ssh/ssh_host_ed25519_key

{# Logging settings: https://man.openbsd.org/sshd#SyslogFacility #}
SyslogFacility AUTHPRIV
{% if sshd_config.log_level is defined %}
LogLevel {{ sshd_config.log_level }}
{% endif %}

{# Authentication settings #}
{% if sshd_config.login_grace_time is defined %}
LoginGraceTime {{ sshd_config.login_grace_time }}
{% endif %}
{% if sshd_config.permit_root_login is defined %}
PermitRootLogin {{ sshd_config.permit_root_login | ternary('yes','no') }}
{% endif %}

{% if sshd_config.strict_mode is defined %}
StrictModes {{ sshd_config.strict_mode | ternary('yes','no') }}
{% endif %}
{% if sshd_config.max_auth_tries is defined %}
MaxAuthTries {{ sshd_config.max_auth_tries }}
{% endif %}
{% if sshd_config.max_sessions is defined %}
MaxSessions {{ sshd_config.max_sessions }}
{% endif %}

{# Public key authentication #}
{% if sshd_config.pubkey_authentication is defined %}
PubkeyAuthentication {{ sshd_config.pubkey_authentication | ternary('yes','no') }}
{% endif %}
AuthorizedKeysFile .ssh/authorized_keys .ssh/authorized_keys2

{# Password authentication settings #}
{% if sshd_config.password_authentication is defined %}
PasswordAuthentication {{ sshd_config.password_authentication | ternary('yes','no') }}
{% endif %}
PermitEmptyPasswords no
ChallengeResponseAuthentication no
{% if sshd_config.interactive_authentication is defined %}
KbdInteractiveAuthentication {{ sshd_config.interactive_authentication | ternary('yes','no') }}
{% endif %}

{# Authentication methods #}
{% if sshd_config.authentication_methods is defined %}
AuthenticationMethods {{ sshd_config.authentication_methods }}
{% endif %}

{# Security settings #}
{% if sshd_config.use_pam is defined %}
UsePAM {{ sshd_config.use_pam | ternary('yes','no') }}
{% endif %}
{% if sshd_config.allow_tcp_forwarding is defined %}
AllowTcpForwarding {{ sshd_config.allow_tcp_forwarding | ternary('yes','no') }}
{% endif %}
{% if sshd_config.allow_agent_forwarding is defined %}
AllowAgentForwarding {{ sshd_config.allow_agent_forwarding | ternary('yes','no') }}
{% endif %}
{% if sshd_config.x11_forwarding is defined %}
X11Forwarding {{ sshd_config.x11_forwarding | ternary('yes','no') }}
{% endif %}
PrintMotd no
{% if sshd_config.print_last_log is defined %}
PrintLastLog {{ sshd_config.print_last_log | ternary('yes','no') }}
{% endif %}
{% if sshd_config.tcp_keep_alive is defined %}
TCPKeepAlive {{ sshd_config.tcp_keep_alive | ternary('yes','no') }}
{% endif %}

{# Keepalive settings #}
{% if sshd_config.client_alive_interval is defined %}
ClientAliveInterval {{ sshd_config.client_alive_interval }}
{% endif %}
{% if sshd_config.client_alive_count_max is defined %}
ClientAliveCountMax {{ sshd_config.client_alive_count_max }}
{% endif %}

{# Connection limits #}
{% if sshd_config.max_startups is defined %}
MaxStartups {{ sshd_config.max_startups }}
{% endif %}

{# Environment variables allowed to be passed to the session #}
AcceptEnv LANG LC_*

{# SFTP subsystem configuration #}
Subsystem sftp /usr/lib/openssh/sftp-server
